# AGENT.md

このドキュメントは、AIエージェントがこのリポジトリで作業する際に理解すべき設計方針と構造を説明します。

## 1. Architecture Overview

このリポジトリは完全なクライアントサイドアプリケーションです。バックエンドサーバーやデータベースは一切使用していません。これは一般的なWebアプリケーションとは異なる重要な特徴であり、すべてのデータ処理と永続化がブラウザ内で完結します。

すべてのデータは `localStorage` の `personal_dashboard_v1` キーに JSON 形式で保存されます。サーバーへのAPI呼び出しは存在せず、ユーザー認証も不要です。このアーキテクチャにより、プライバシーが保護され、オフラインでも動作可能なシンプルなパーソナルツールとして機能します。

## 2. Layer Structure

このアプリケーションは4層のアーキテクチャを採用しています。

**プレゼンテーション層**は `src/app/` 配下のページコンポーネントで構成されます。各ページはユーザーインターフェースの表示とユーザー操作の受け付けを担当します。

**コンポーネント層**は `src/components/` 配下の再利用可能なUIコンポーネントで構成されます。`Header.tsx` はナビゲーションを提供し、`ui/` ディレクトリには shadcn/ui ベースの汎用コンポーネント（Button、Card、Dialog、Input、Select、Badge、Label、Sonner）が含まれます。

**ビジネスロジック層**は `src/lib/` 配下のユーティリティと型定義で構成されます。`types.ts` でデータモデルを定義し、`utils.ts` でスタイリング用のヘルパー関数を提供します。

**永続化層**は `src/lib/storage.ts` が担当します。このファイルがすべてのデータ操作の中心となっており、localStorage への読み書きを一元管理しています。CRUD操作（`getEntries`、`addEntry`、`updateEntry`、`deleteEntry`）、データのエクスポート・インポート（`exportData`、`importData`）、リセット（`resetData`）、ダミーデータ生成（`loadDummyData`）などの機能を提供します。

新機能を追加する際は、この層構造を維持してください。特にデータ操作は必ず `storage.ts` を経由し、ページコンポーネントから直接 localStorage にアクセスしないでください。

## 3. Main Pages and Their Roles

**`/dashboard`** は読み取り専用の分析ページです。KPIカード（今週の記録数、連続日数、目標達成率）と、7日間または30日間の記録推移チャート、最新のアクティビティ一覧を表示します。データの変更は行わず、`getEntries()` で取得したデータを可視化することに専念しています。

**`/entries`** はCRUD操作を行うメインページです。記録の一覧表示、検索・フィルタリング（キーワード、タグ、期間）、新規追加、編集、削除の機能を提供します。ダイアログを使用したフォーム入力により、ユーザーが記録を管理できます。

**`/settings`** はデータの一括操作とテーマ設定を行うページです。ダミーデータの投入、全データのリセット、JSON形式でのエクスポート・インポート、ダークモード・ライトモードの切り替え機能を提供します。

## 4. Tech Stack

このアプリケーションは以下の技術を使用しています。

フレームワークとして **Next.js 16（App Router）** を採用しています。これは比較的新しいバージョンであり、App Router の規約に従ってページとレイアウトを構成しています。Server Components の機能は使用せず、すべてのページで `"use client"` ディレクティブを指定してクライアントサイドレンダリングを行っています。

言語は **TypeScript** を使用し、型安全性を確保しています。

スタイリングには **Tailwind CSS v4** を使用しています。これも比較的新しいバージョンであり、`@theme inline` ブロックによるテーマトークン定義など、v4 固有の機能を使用しています。CSS変数によるカラーテーマ管理を行い、ダークモードにも対応しています。

UIコンポーネントライブラリとして **shadcn/ui** を採用しています。Radix UI プリミティブをベースに、`class-variance-authority` でバリアント管理を行っています。

チャート表示には **Recharts** を使用しています。

これらの技術バージョンの制約を理解し、ドキュメントを参照する際は適切なバージョンの情報を確認してください。

## 5. Data Model

アプリケーションの中心となるデータモデルは `Entry` インターフェースです。

```typescript
interface Entry {
  id: string;      // 一意の識別子（タイムスタンプ + ランダム文字列）
  title: string;   // 記録のタイトル（必須）
  note?: string;   // メモ（オプション）
  tags: string[];  // タグの配列
  date: string;    // ISO形式の日付文字列
  value: number;   // 数値（記録の値）
}
```

`id` は `generateId()` 関数により `Date.now()` とランダム文字列を組み合わせて生成されます。`date` は ISO 8601 形式の文字列として保存され、表示時に `toLocaleDateString("ja-JP")` でフォーマットされます。

## 6. Common Patterns

このリポジトリでは以下のコーディングパターンが一貫して使用されています。

**クライアントサイドディレクティブ**: すべてのページコンポーネントはファイルの先頭に `"use client"` ディレクティブを記述しています。これはサーバーレスアーキテクチャの特性上、すべてのコンポーネントがクライアントサイドで実行される必要があるためです。

**データ読み込み関数**: 各ページでは `useCallback` を使用してデータ読み込み関数（`loadData`）を定義し、`useEffect` で初期化時に呼び出しています。データ変更後も同じ関数を呼び出してステートを更新します。

**トースト通知**: ユーザーへのフィードバックには `sonner` ライブラリの `toast` を使用しています。成功時は `toast.success()`、エラー時は `toast.error()` を呼び出し、操作結果を通知します。

**スタイリングパターン**: Tailwind CSS のユーティリティクラスを使用し、条件付きクラス適用には `cn()` ユーティリティ関数を使用します。アニメーションには `animate-in`、`fade-in`、`slide-in-from-*` などのクラスを使用し、`transition-*` クラスでホバーエフェクトを実装しています。

---

## Design Philosophy Notes

**RootLayout の役割**: `src/app/layout.tsx` の `RootLayout` がすべてのページをラップしています。ここで `Header` コンポーネントと `Toaster` コンポーネントを配置し、全ページで共通のナビゲーションとトースト通知機能を提供しています。

**サーバーレス設計の意図**: このアプリケーションは意図的にサーバーを使用しない設計となっています。一般的なWebアプリケーションではバックエンドAPIやデータベースを使用しますが、このアプリケーションでは localStorage のみでデータを管理します。この設計により、デプロイが簡単で、ユーザーのプライバシーが保護され、オフラインでも動作可能です。新機能を追加する際も、この設計思想を維持してください。

**実装詳細より設計方針を重視**: このドキュメントは実装の詳細よりも設計方針を中心に記載しています。これにより、AIエージェントが個々のコードを読む前に全体像を把握し、適切な判断を下しやすくなることを意図しています。
